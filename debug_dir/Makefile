GDB_MACROS = ../a.gdb
VALGRIND_SUPP = ../v.supp

gdb_file:
	@echo "define fds"                      >  $(GDB_MACROS)
	@echo "	display exec->stdout_fd"        >> $(GDB_MACROS)
	@echo "	display exec->stdin_fd"         >> $(GDB_MACROS)
	@echo "	display exec->pipe_fds[0]"      >> $(GDB_MACROS)
	@echo "	display exec->pipe_fds[1]"      >> $(GDB_MACROS)
	@echo "	display fds[0]"                 >> $(GDB_MACROS)
	@echo "	display fds[1]"                 >> $(GDB_MACROS)
	@echo "end"                               >> $(GDB_MACROS)
	@echo ""                                  >> $(GDB_MACROS)
	@echo "define tok2"                         >> $(GDB_MACROS)
	@echo "	set \$$z = 0"                     >> $(GDB_MACROS)
	@echo "	while ((*token)[\$$z].content != (void *)0)" >> $(GDB_MACROS)
	@echo "		p (*token)[\$$z]"              >> $(GDB_MACROS)
	@echo "		set \$$z = \$$z + 1"            >> $(GDB_MACROS)
	@echo "	end"                             >> $(GDB_MACROS)
	@echo "end"                               >> $(GDB_MACROS)
	@echo ""                                  >> $(GDB_MACROS)
	@echo "define tok"                         >> $(GDB_MACROS)
	@echo "	set \$$z = 0"                     >> $(GDB_MACROS)
	@echo "	while (token[\$$z].content != (void *)0)" >> $(GDB_MACROS)
	@echo "		p token[\$$z]"                >> $(GDB_MACROS)
	@echo "		set \$$z = \$$z + 1"            >> $(GDB_MACROS)
	@echo "	end"                             >> $(GDB_MACROS)
	@echo "end"                               >> $(GDB_MACROS)
	@echo ""                                  >> $(GDB_MACROS)
	@echo "define test"                         >> $(GDB_MACROS)
	@echo "	p get_next_line_bonus(fds[0])"   >> $(GDB_MACROS)
	@echo "	p sleep(1)"                      >> $(GDB_MACROS)
	@echo "	run"                             >> $(GDB_MACROS)
	@echo "end"                               >> $(GDB_MACROS)
	@echo ""                                  >> $(GDB_MACROS)
	@echo "define inpipe"                         >> $(GDB_MACROS)
	@echo "	p get_next_line_bonus(fds[0])"        >> $(GDB_MACROS)
	@echo "end"                               >> $(GDB_MACROS)
	@echo ""                                  >> $(GDB_MACROS)
	@echo "define cmd"                        >> $(GDB_MACROS)
	@echo "	set \$$z1 = 0"                    >> $(GDB_MACROS)
	@echo "	while (exec->commands[\$$z1] != (void *)0)" >> $(GDB_MACROS)
	@echo "		set \$$z2 = 0"                >> $(GDB_MACROS)
	@echo "		p \$$z1"                       >> $(GDB_MACROS)
	@echo "		while (exec->commands[\$$z1][\$$z2] != (void *)0)" >> $(GDB_MACROS)
	@echo "			p exec->commands[\$$z1][\$$z2]" >> $(GDB_MACROS)
	@echo "			set \$$z2 = \$$z2 + 1"      >> $(GDB_MACROS)
	@echo "		end"                         >> $(GDB_MACROS)
	@echo "		set \$$z1 = \$$z1 + 1"          >> $(GDB_MACROS)
	@echo "	end"                             >> $(GDB_MACROS)
	@echo "end"                               >> $(GDB_MACROS)
		@echo ""                                  >> $(GDB_MACROS)
	@echo "define doc"                        >> $(GDB_MACROS)
	@echo "	set \$$z = 0"                    >> $(GDB_MACROS)
	@echo "	while (\$$z != exec->last_cmd)" >> $(GDB_MACROS)
	@echo "		p exec->here_doc_fds[\$$z]"      >> $(GDB_MACROS)
	@echo "		set \$$z = \$$z + 1"      >> $(GDB_MACROS)
	@echo "	end"                             >> $(GDB_MACROS)
	@echo "end"                               >> $(GDB_MACROS)

valgrind_file:
	@echo "{" > $(VALGRIND_SUPP)
	@echo "   suppress_readline_leaks readline" >> $(VALGRIND_SUPP)
	@echo "   Memcheck:Leak" >> $(VALGRIND_SUPP)
	@echo "   ..." >> $(VALGRIND_SUPP)
	@echo "   fun:readline" >> $(VALGRIND_SUPP)
	@echo "}" >> $(VALGRIND_SUPP)
	@echo "" >> $(VALGRIND_SUPP)
	@echo "{" >> $(VALGRIND_SUPP)
	@echo "   suppress_readline_leaks add_history" >> $(VALGRIND_SUPP)
	@echo "   Memcheck:Leak" >> $(VALGRIND_SUPP)
	@echo "   ..." >> $(VALGRIND_SUPP)
	@echo "   fun:add_history" >> $(VALGRIND_SUPP)
	@echo "}" >> $(VALGRIND_SUPP)
	@echo "" >> $(VALGRIND_SUPP)
	@echo "{" >> $(VALGRIND_SUPP)
	@echo "   suppress_sys_function" >> $(VALGRIND_SUPP)
	@echo "   Memcheck:Leak" >> $(VALGRIND_SUPP)
	@echo "   ..." >> $(VALGRIND_SUPP)
	@echo "   obj:/usr/bin/*" >> $(VALGRIND_SUPP)
	@echo "}" >> $(VALGRIND_SUPP)


.PHONY: gdb_file valgrind_file